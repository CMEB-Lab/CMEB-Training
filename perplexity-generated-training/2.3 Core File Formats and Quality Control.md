<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" class="logo" width="120"/>

# Core File Formats & Quality Control Training Manual (Module 2.3)

A 20-hour, competency-based program to master the foundational bioinformatics file formats and quality-control workflows essential for robust NGS data analysis and technical interviews.

## Learning Objectives

By module completion, learners will be able to:

1. **Explain and parse** the structure of FASTQ, SAM/BAM, VCF, GTF/GFF, and BED files.
2. **Use command-line tools** to inspect, validate, and convert between formats (e.g., `samtools`, `bcftools`, `bedtools`).
3. **Perform quality control** on raw sequencing data using FastQC and aggregate reports with MultiQC.
4. **Integrate format handling and QC** into reproducible shell scripts for automated pipelines.

## Week 1 (Days 1–3): Format Fundamentals & Inspection

### Day 1: FASTQ Format Mastery (4 hours)

1. **Conceptual Overview**

- Four-line record:
– Line 1 ‘@’ + identifier
– Line 2 sequence
– Line 3 ‘+’ + optional identifier
– Line 4 quality string (Phred+33 encoding) [^1].
- Variants: Sanger vs. Illumina/QS scores [^2][^1].

2. **Command-line Exercises**

- Count reads:

```bash
grep -c ‘^@‘ sample.fastq
```

- Extract sequences vs. qualities:

```bash
sed -n ‘2~4p’ sample.fastq   # sequences  
sed -n ‘4~4p’ sample.fastq   # quality lines  
```

- Validate record integrity:

```bash
awk ‘NR%4==1{if(substr($0,1,1)!=“@“)exit 1} NR%4==3{if(substr($0,1,1)!=“+”)exit 1}’ sample.fastq
```

3. **Hands-on**
Write `fastq_validator.sh` that:
– Checks line-count divisible by 4
– Verifies headers and quality-line markers
– Reports PASS/FAIL per file

### Day 2: SAM/BAM Format & Conversion (4 hours)

1. **Structure & Indexing**

- SAM: tab-delimited text with headers (‘@HD’, ‘@SQ’, …) and alignment lines [^3].
- BAM: compressed binary; requires `.bai` index for random access.

2. **Key Tools**

- View & stats: `samtools view`, `samtools flagstat`, `samtools idxstats`
- Convert BAM↔SAM:

```bash
samtools view -h -o out.sam in.bam     # BAM→SAM  
samtools view -b -o out.bam in.sam     # SAM→BAM  
```

- Indexing:

```bash
samtools index out.bam
```

3. **Hands-on**
– Convert provided `aligned.bam` → SAM → re-index
– Extract mapped reads:
```bash
samtools view -b -F 4 aligned.bam > mapped.bam
```


### Day 3: VCF, GTF/GFF & BED Formats (4 hours)

1. **VCF (Variant Call Format)**

- Meta-info (`##`), header (`#CHROM …`), and data lines [^4].
- Fields: CHROM, POS, ID, REF, ALT, QUAL, FILTER, INFO, FORMAT.

2. **GTF/GFF (Gene Annotation)**

- Nine-column tab format: seqname, source, feature, start, end, score, strand, frame, attributes.
- Attribute parsing (`ID=…; gene_name=…;`).

3. **BED (Interval)**

- At least 3 fields: chrom, chromStart (0-based), chromEnd (1-based).
- Optional fields: name, score, strand, thickStart, thickEnd, itemRgb.

4. **Command-line Exercises**
– View header lines:
```bash
grep ‘^##’ variants.vcf | head  
```

– Filter variants by QUAL ≥ 30:

```bash
bcftools filter -e ‘QUAL<30’ -o highqual.vcf variants.vcf  
```

– Extract exonic regions:

```bash
bedtools intersect -a variants.vcf -b genes.gtf -wa  
```

5. **Hands-on**
– Write a script `format_converter.sh` that converts GTF→BED (extract exons).
– Parse a VCF to tabular CSV with Python or `bcftools query`.

## Week 2 (Days 4–6): Quality Control Workflows

### Day 4: FastQC Analysis (4 hours)

1. **FastQC Reports**

- Per-base quality, GC content, sequence duplication, overrepresented sequences.

2. **Command-line**
```bash
fastqc sample.fastq -o qc_reports/  
```

– Examine `sample_fastqc.html`, interpret warnings vs. failures.

3. **Hands-on**
– Run FastQC on all FASTQ in `raw_data/`.
– Summarize adapter contamination rates and base-quality drops.

### Day 5: MultiQC Aggregation (4 hours)

1. **MultiQC Usage**

- Aggregates FastQC (and other) outputs into single interactive report.

2. **Command-line**
```bash
multiqc qc_reports/ -o multiqc_report/  
```

– Interpret overall project-wide QC metrics.

3. **Hands-on**
– Integrate FastQC + alignment stats (samtools flagstat) into MultiQC workflow.
– Customize report sections via `multiqc_config.yaml`.

### Day 6: Automation & Integration (4 hours)

1. **Shell Scripting**
– Loop over samples to run FastQC, samtools stats, and MultiQC.
– Error handling (`set -euo pipefail`) and logging.
2. **Deliverable Script**: `run_qc_pipeline.sh`
```bash
#!/bin/bash
set -euo pipefail
raw_dir=“raw_data”
qc_dir=“qc_reports”
out_dir=“multiqc_report”
mkdir -p “$qc_dir”
for fq in “$raw_dir”/*.fastq; do
  fastqc “$fq” -o “$qc_dir”
done
multiqc “$qc_dir” -o “$out_dir”
```

3. **Hands-on**
– Execute pipeline on provided dataset.
– Validate pipeline: introduce a corrupted FASTQ to test error exit and logging.

## Assessment Framework

| Competency Area | Beginner (0–60%) | Intermediate (61–80%) | Advanced (81–100%) |
| :— | :— | :— | :— |
| FASTQ Validation | Can view records | Writes basic validator script | Implements robust error handling and QC metrics calculation |
| SAM/BAM Handling | Views & converts files | Extracts subsets & indexes | Integrates into automated pipelines with conditional logic |
| VCF/GTF/GFF/BED Parsing | Inspects headers & data lines | Filters & converts between formats | Builds custom parsers & integrates variant/annotation intersections |
| QC Tools | Runs FastQC & MultiQC | Interprets reports & flags issues | Automates multi-tool QC, customizes reports, integrates alignment stats |

### Key References

1. FASTQ format specification and variants [^2][^1]
2. SAM/BAM I/O with samtools and tutorials [^3]
3. VCF 4.x specification [^4][^5]
4. GTF/GFF format guides (Ensembl/Bioinformatics wikis)
5. BED tools documentation (BEDTools suite)
6. FastQC and MultiQC manuals

Upon completion, learners will possess the command-line expertise and scripting skills to handle core bioinformatics file formats and quality-control workflows with confidence—critical for both technical interviews and production-grade NGS pipelines.

<div style="text-align: center">⁂</div>

[^1]: https://en.wikipedia.org/wiki/FASTQ_format

[^2]: https://maq.sourceforge.net/fastq.shtml

[^3]: https://seqan.readthedocs.io/en/seqan-v1.4.2/Tutorial/BasicSamBamIO.html

[^4]: http://www.internationalgenome.org/wiki/Analysis/Variant Call Format/vcf-variant-call-format-version-40/

[^5]: https://learn.gencore.bio.nyu.edu/ngs-file-formats/vcf-format/

[^6]: https://omicstutorials.com/guide-how-to-convert-bam-to-sam/

[^7]: https://scikit.bio/docs/dev/generated/skbio.io.format.fastq.html

[^8]: https://epi2me.nanoporetech.com/notebooks/Introduction_to_SAM_and_BAM_files.html

[^9]: https://contactzilla.com/how-to-create-a-vcf-file/

[^10]: https://pmc.ncbi.nlm.nih.gov/articles/PMC2847217/

[^11]: https://omicstutorials.com/step-by-step-instructions-exploring-and-visualizing-sam-bam-files/

[^12]: https://eriqande.github.io/eca-bioinf-handbook/basic-handling-of-vcf-files.html

[^13]: https://www.zymoresearch.com/blogs/blog/fastq-file-format

[^14]: https://hbctraining.github.io/Intro-to-rnaseq-hpc-O2/lessons/04_alignment_quality.html

[^15]: https://epi2me.nanoporetech.com/notebooks/Introduction_to_Variant_Call_Format_(vcf)_files.html

[^16]: https://obitools4.metabarcoding.org/formats/fastq/

[^17]: https://learn.gencore.bio.nyu.edu/ngs-file-formats/sambam-format/

[^18]: https://gatk.broadinstitute.org/hc/en-us/articles/360035531692-VCF-Variant-Call-Format

[^19]: https://support.illumina.com/help/BaseSpace_Sequence_Hub_OLH_009008_2/Source/Informatics/BS/FileFormat_FASTQ-files_swBS.htm

[^20]: https://www.youtube.com/watch?v=vh6l9aPFUgU

